<!--  Top navigation -->
@if (categoryQuery.isSuccess() && categoryQuery.data()) {
  <nav class="flex gap-4 border-b pb-2 mb-4">
    <!-- Featured -->
    <a 
      [routerLink]="['/shop/collection/products']"
      [queryParams]="{}"
      routerLinkActive="font-bold border-b-2 border-blue-500"
    >
      Featured
    </a>

    <!-- Categories -->
    @for (category of categoryQuery.data().content!; track category) {
      <a 
        [routerLink]="['/shop/collection/products']"
        [queryParams]="{ category: category.publicId }"
        routerLinkActive="font-bold border-b-2 border-blue-500"
      >
        {{ category.name }}
      </a>
    }
  </nav>
}

<!-- Featured Products (default view when no category selected) -->
@if (!category()) {
  <div class="grid grid-cols-1 sm:grid-cols-2 gap-2 md:grid-cols-3 lg:grid-cols-4 w-full">
    @if (featuredProductQuery.isSuccess()) {
      @for (product of featuredProductQuery.data().content; track product.publicId) {
        <app-product-card [product]="product"></app-product-card>
      }
    }
    @else if (featuredProductQuery.isPending()) {
      <div class="flex w-full justify-center">
        <span class="loading loading-spinner loading-lg"></span>
      </div>
    }
    @else if (featuredProductQuery.isError()) {
      <div class="alert alert-error">
        <span>Error! Failed to load Featured Products, please try again</span>
      </div>
    }
  </div>
}

<!-- Sidebar filters + Product grid (when category selected) -->
@if (category()) {
  <div class="grid grid-cols-[1fr_6fr] gap-5">
    <!-- Sidebar filter -->
    <div class="ms-5 sm:ms-0">
      <app-filter-product
        [sort]="sort()!"
        [size]="size()!"
        (productFilter)="onFilterChange($event)">
      </app-filter-product>
    </div>

    <!-- Products grid -->
    @if (filteredProductsQuery.isSuccess() && filteredProductsQuery.data().content.length !== 0) {
      <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3">
        @for (product of filteredProductsQuery.data().content; track product.publicId) {
          <app-product-card [product]="product"></app-product-card>
        }
      </div>
    }
    @else if (filteredProductsQuery.isFetching()) {
      <div class="flex w-full justify-center">
        <span class="loading loading-spinner loading-lg"></span>
      </div>
    }
    @else if (filteredProductsQuery.isSuccess() && filteredProductsQuery.data().content.length === 0) {
      <div class="flex justify-center items-center flex-col">
        <div class="font-bold text-2xl">No Results</div>
        <div class="">Try to change your filters</div>
      </div>
    }
  </div>
}
